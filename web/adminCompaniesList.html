<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css"  media="all">

</head>
<body>
<table class="layui-hide" id="demo"></table>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/jquery.min.js"></script>


<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>企业用户表格</legend>
</fieldset>


<table class="layui-table" lay-skin="line">
    <colgroup>
        <col width="150">
        <col width="200">
        <col>
    </colgroup>
    <thead>
    <tr>
        <th>企业名称</th>
        <th>账户</th>
        <th>联系方式</th>
        <th>公司地址</th>
        <th>公司简介</th>
        <th>操作</th>
    </tr>
    </thead>

    <tbody id="company">
    <!--添加的数据-->
    </tbody>
</table>
<!--分页行-->
<div id="laypage"></div>

<script type="text/javascript">

    $(function () {
        getData()  //请求数据
        getPage()    //分页操作
    });
    let pageNum = 1; //设置首页页码
    let pageSize = 2;  //设置一页显示的条数
    let total;    //总条数
    let  pages; //一共多少页

    function getData() {
        $.ajax({
            url: "AdminServlet?method=getCompanyByPage",
            method:"post",
            async: false,    //很重要
            dataType: 'json',
            data: {
                pageNum: pageNum,
                pageSize: pageSize,
            },
            success: function (data) {

                total = data.dataCount;  //设置总条数
                pages =  data.pageCount;  //设置总页数
                console.log(data.datas);
                let cpys = data.datas;     //companies
                let html = '';
                for (let i = 0; i < cpys.length; i++) {

                    html += "<tr>"+
                        "<td>" + cpys[i].cpyname+ "</td>" +
                        "<td>" + cpys[i].cpyaccount+ "</td>" +
                        "<td>" + cpys[i].cpyphone+"</td>"+
                        "<td>" + cpys[i].cpyaddress+"</td>"+
                        "<td>" + cpys[i].cpyinfo+"</td>";

                  html+="<td><a href='AdminServlet?method=getCompanyByIdAndOccupation&&companyid="+cpys[i].id+"'>查看</td>"+"<tr>";
                }
                console.log(html)
                $("#company").empty().append(html);
            }
            ,error:function () {
                layer.msg("获取失败")
            }
        });
    }

    function getPage() {
        layui.use('laypage', function () {
            let laypage = layui.laypage;
            //执行一个laypage实例
            laypage.render({
                elem: 'laypage',  //注意laypage是 ID，不用加 # 号
                count: total, //数据总数，从服务端得到
                limit: pageSize,   //每页条数设置
                limits: [pageSize, 20, 30],			//可选每页显示条数
                curr: 1,                      //起始页
                groups: 3,                     //连续页码个数
                prev: '上一页',               //上一页文本
                next: '下一页',                //下一页文本
                first: 1,                    //首页文本
                last: pages,                   //尾页文本
                layout: ['prev', 'page', 'next', 'limit', 'refresh', 'skip'],
                jump: function (obj, first) {  //触发分页后的回调
                    //obj包含了当前分页的所有参数，第一次加载first为true
                    console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                    console.log(obj.limit); //得到每页显示的条数
                    pageNum = obj.curr;  //改变当前页码
                    pageSize = obj.limit;
                    //首次不执行，一定要加此判断，否则初始时会无限刷新
                    if (!first) {
                        getData()  //加载数据
                    }
                }
            });
        });
    }





</script>







</body>
</html>
